# Azure Route Server Demo with two VNAs

Vnet1 represents an on-premise location. VM1 terminates two IPsec tunnels on both VNAs (VM2 and VM3) in vnet2. Wireguard and FRR (Fast Range Routing) is used on Linux VMs to create the route-based VPN setup. 

## Wireguard setup VM1, VM2 and VM3

On VM1, VM2 and VM3
```sh
sudo apt update
```

Edit file /etc/sysctl.conf and remove the "#" in this line: 
```sh
net.ipv4.ip_forward=1
```
And execute:
```sh
sudo sysctl -p
```
This will enable forwarding of traffic through the NVAs later on.

Install wireguard:
```sh
sudo apt install wireguard on VM1, VM2 and VM3
```

First setup the encrypted wire between VM1 and VM2. We start by generating public, private and pre-shared keys on VM1 and VM2:

Write down both the public IPs of VM1 and VM2 and the keys which have been generated by this commands on VM1 and VM2.

```sh
sudo su
wg genkey > wg0.key
wg pubkey < wg0.key > wg0.pub
wg genpsk > wg0.psk
```

Use the keys and public IPs to generate this file /etc/wireguard/wg0.conf on VM1
```sh
[Interface]
ListenPort = 51820
Address = 172.31.1.1/30
PrivateKey = <private key of VM1>
Table = off

[Peer]
PublicKey = <public key of VM2>
PreSharedKey = <pre-shared key of VM1>
AllowedIPs = 0.0.0.0/0
Endpoint = <public ip VM2>:51820
PersistentKeepalive = 25
```

And on /etc/wireguard/wg0.conf on VM2:
```sh
[Interface]
ListenPort = 51820
Address = 172.31.1.2/30
PrivateKey = <private key of VM2>
Table = off

[Peer]
PublicKey = <public key of VM1>
PreSharedKey = <pre-shared key of VM1>
AllowedIPs = 0.0.0.0/0
Endpoint = <public ip VM1>:51820
PersistentKeepalive = 25
```

Then issue on VM1 and VM2:
```sh
ip link add dev wg0 type wireguard
wg setconf wg0 /etc/wireguard/wg0.conf
ip link set wg0 up
```

Finally activate the config on VM1 and VM2:
```sh
sudo systemctl restart wg-quick@wg0
```

Repeat this for the link between VM1 and VM3. So write down public IPs of VM1 and VM3 and generate keys on the VMs. Change the the ports to 51821 and the private subnet of the link to 172.31.1.4/30 while creating the wireguard config file.

Then issue on VM1 and VM3:
```sh
ip link add dev wg1 type wireguard
wg setconf wg0 /etc/wireguard/wg1.conf
ip link set wg1 up
```

Finally activate the config on VM1 and VM3:
```sh
sudo systemctl restart wg-quick@wg1
```




















![image info](./media/general_tab.png)


```sh
import music_cue.command_line
music_cue.command_line.main()
```

Place this file in a separate folder (in the example shown in "MusicCue"). Navigate to the folder using a windows or MAC terminal and execute (see last line in example with "python music_cue_exe.py") the script. A log file named "error-log.txt" is placed in the folder when the App is run for the first time for troubleshooting purposes.

```sh
C:\Users\verke>cd Desktop
C:\Users\verke\Desktop>cd "MusicCue"
C:\Users\verke\Desktop\MusicCue>python music_cue_exe.py
```

